---
sidebar_position: 29

---

> Create by **fall** on 06 Feb 2025
> Recently revised in 06 Feb 2025

## 性能监控

- 主动发现问题和解决问题
- 做产品的决策依据
- 为业务扩展提供了更多可能性
- 提升前端工程师的技术深度和广度（简历亮点）

### 监控方向

**系统稳定性**

- 脚本执行错误
- 资源错误（加载异常
- 请求异常

**用户体验**

- FID：first input delay（首次输入延迟）
- FCP：首屏渲染时间，一般需要在一秒内
- LCP：Largest ContentFul Paint （最大内容绘制）
- TTI：Time to Interreactive（可以使用页面中的内容的时间）
- INP：Interaction to Next Paint（从输入到下一个画面的时间）

**业务**

- 页面浏览和点击量（pageview）
- 访问页面不同 ip 的人数（unique visitor）
- 停留时间

### 监控流程

前端埋点、数据上报、加工汇总、可视化展示、监控预警

### 实现

捕获 js 异常

```js
//一般JS运行时错误使用window.onerror捕获处理
window.addEventListener(
  "error",
  function (event) {
    let lastEvent = getLastEvent();
    // 有 e.target.src(href) 的认定为资源加载错误
    if (event.target && (event.target.src || event.target.href)) {
      tracker.send({
        // 资源加载错误
        type: "error", // resource
        subType:'resource-error'
        // ...
      });
    } else {
      tracker.send({
        type: "error", //error
        errorType: "js-error",
      });
    }
  },
  true
); // true代表在捕获阶段调用,false代表在冒泡阶段捕获,使用true或false都可以
```

捕获 promise 异常

```js
//当Promise 被 reject 且没有 reject 处理器的时候，会触发 unhandledrejection 事件
window.addEventListener(
  "unhandledrejection",
  function (event) {
    let lastEvent = getLastEvent();
    let message = "";
    let line = 0;
    let column = 0;
    let file = "";
    let stack = "";
    if (typeof event.reason === "string") {
      message = event.reason;
    } else if (typeof event.reason === "object") {
      message = event.reason.message;
    }
    let reason = event.reason;
    if (typeof reason === "object") {
      if (reason.stack) {
        var matchResult = reason.stack.match(/at\s+(.+):(\d+):(\d+)/);
        if (matchResult) {
          file = matchResult[1];
          line = matchResult[2];
          column = matchResult[3];
        }
        stack = getLines(reason.stack);
      }
    }
    tracker.send({
      //未捕获的promise错误
      kind: "stability", //稳定性指标
      type: "error", //jsError
      errorType: "promiseError", //unhandledrejection
      message: message, //标签名
      filename: file,
      position: line + ":" + column, //行列
      stack,
      selector: lastEvent
        ? getSelector(lastEvent.path || lastEvent.target)
        : "",
    });
  },
  true
); // true代表在捕获阶段调用,false代表在冒泡阶段捕获,使用true或false都可以
```



## 参考文章

| 作者      | 链接                                 |
| --------- | ------------------------------------ |
| miracle90 | https://github.com/miracle90/monitor |
|           |                                      |
|           |                                      |
|           |                                      |
|           |                                      |

