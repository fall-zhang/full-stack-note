> Create by **fall** on 25 Feb 2024<br/>
> Recently revised in 25 Feb 2024

## postgresql

### 数据库操作

```bash
# 创建数据库
createdb mydb
# 移除数据库
dropdb mydb
# 访问数据库
psql mydb
```

### 表操作

PostgreSQL 支持标准的 SQL 类型，以及其他的通用功能的类型和丰富的几何类型。

标准的 SQL 类型：`int`、`smallint`、`real`、`double precision`、`char(<number>)`、`varchar(<number>)`、`date`、`time`、`timestamp`和`interval`

- `varchar(80)`指定了一个可以存储最长 80 个字符的任意字符串的数据类型。
- `int`是普通的整数类型。
- `real`是一种用于存储单精度浮点数的类型。
- `date` 类型应该可以自解释

### 创建表

```sql
CREATE TABLE weather {
  -- 行注释
	city    varchar(80),
	temp_lo  int,
	temp_hi  int,
	prcp     re4al,
	date     date,
	-- point 是 pg 特有数据类型 
	location point
};

# 删除表：
DROP TABLE tablename;
```

> - 可以手动输入换行符号，`psql` 可以识别该命令直到分号才结束。
> - 空白字符可以自由使用（不必对齐每个字符）
> - 行注释：`--`
> - SQL 对关键字和标识符不区分大小写，标识符用双引号括起来可以保留大小写
> - 虽然列的插入，有严格的顺序， 但 SQL 并不对 行 在表中的顺序做任何保证

### 行操作

```sql
# 按照列的顺序进行插入
INSERT INTO weather VALUES ('San Francisco', 46, 50, 0.25, '1994-11-27', '(-194.0, 53.0)')

# 更推荐该方法插入数据，而不是隐含依赖
# 按照字段顺序进行插入，也可以忽略一些数据的插入
INSERT INTO weather (city, temp_lo, temp_hi, prcp, date)
    VALUES ('San Francisco', 43, 57, 0.0, '1994-11-29');
```

确保所有数据类型都相当明确。那些不是简单数字值的常量，通常必需用单引号 `'` 包裹。

```sql
# 使用 COPY 从文本文件中装载大量数据
COPY weather FROM '/home/user/weather.txt';
```

### 表查询

按照表头查询

```sql
# 查询所有的 weather 字段
SELECT * FROM weather;
# 对应如下字段
SELECT city, temp_lo, temp_hi, prcp, date, location FROM weather;
# 对查询的字段进行处理
SELECT city, (temp_hi+temp_lo)/2 AS temp_avg, date FROM weather;
```

条件查询

```sql
# 查找 'San Francisco' 并且为降雨天气
SELECT * FROM weather
    WHERE city = 'San Francisco' AND prcp > 0.0;
```

查询排序

```sql
# 按照城市排序
SELECT * FROM weather
    ORDER BY city;
# 按照城市以及温度进行排序
SELECT * FROM weather
    ORDER BY city, temp_lo;
```

按照集合查询数据

```sql
# 以集合形式返回查询结果，并且根据名称排序
SELECT DISTINCT city
    FROM weather;
    ORDER BY city;
```

> 虽然 `SELECT *` 对于查询很有用，但普遍认为是很糟糕的风格，因为给表增加一列就会改变查询结果。      









## 参考文章

| 文章名称             | 链接                                                |
| -------------------- | --------------------------------------------------- |
| PostgreSQL 17.5 手册 | http://www.postgres.cn/docs/17/tutorial-select.html |
|                      |                                                     |
|                      |                                                     |
|                      |                                                     |

